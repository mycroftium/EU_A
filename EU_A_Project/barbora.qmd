---
title: "Group project"
format: html
editor: visual
---

# Option 2 Immigration and Dutch news outlets

## Graphs

**General transformations**

Compute most trusted medium per person

w2_q27 Media Trust \[TV\]

W2_Q28 Media trust \[NP;radio;interet\]

**Readership immigration attitudes**


W2_Q42 Anti-immigrant attitudes

W1_Q42 Anti-immigrant attitudes

w2_q27 Media Trust \[TV\]

W2_Q28 Media trust \[NP;radio;interet\]

*Variation*

W1_Q54 Intergroup comfort: Muslims

W1_Q56 Intergroup comfort: Poles

**Wordcloud Immigrant follow-up**

Most trusted medium

W1_Q43 Immigrant follow up

**Readership demographics**

Choropleth Map


W2_Q28 Media trust \[NP;radio;interet\]

w2_q27 Media Trust \[TV\]

NIELSENCBS (region)

**Immigration stories proportion over time**


**Immigration stories emotion**


## Variables Needed

**Dataset MCA EPE 2014 NL FINAL.csv**

Rows: Outlet value 111-115\
Columns:

-   V4 (Outlet)

-   V6_cleaned (Topic)

-   V3b (date)

-   V3c (year)

-   NL1 a-e (emotion)

-   NL2 (Muslims and Poles)

-   NL3 (Muslims and Poles)

-   NL4 (Muslims and Poles)

-   NL5 (Muslims and Poles)

**All waves GENERAL.csv**

Rows: GENERAL

Columns:

-   waves (GFor which waves we have info)

-   OPLA (Education)

-   GSL (gender)

-   LFT (age)

-   NIELSENCBS (region)

-   w1_q1 (Most important issue in case I can use it)

-   W1_Q53 Intergroup contact: Muslims

-   W1_Q54 Intergroup comfort: Muslims

-   W1_Q55 Intergroup contact: Poles

-   W1_Q56 Intergroup comfort: Poles

-   W1_Q68 Ethnic minority

-   W1_Q42 Anti-immigrant attitudes

-   W1_Q43 Immigrant follow up

-   w2_q27_1 **RTL Nieuws** **19.30**

-   w2_q27_2 **NOS Journaal** **20.00**

-   W2_Q28: Media trust \[NP;radio;interet\]

    **1. De Telegraaf** w2_q28_1\
    **2. NRC Handelsblad** w2_q28_2\
    **6. De Volkskrant** w2_q28_6\
    **11. nu.nl^\*^** w2_q28_11

| Question                                | Waves      |
|-----------------------------------------|------------|
| w1_q1 Most important issue              | 1, 2, 3, 4 |
| W1_Q54 Intergroup comfort: Muslims      | 1, 2       |
| W1_Q56 Intergroup comfort: Poles        | 1, 2       |
| W1_Q68 Ethnic minority                  | 1          |
| W1_Q42 Anti-immigrant attitudes         | 1, 2       |
| W1_Q43 Immigrant follow up              | 1, 2       |
| w2_q27 Media Trust \[TV\]               | 2          |
| W2_Q28 Media trust \[NP;radio;interet\] | 2          |

## Method

### Cleaning

#### Libraries

```{r}
library(tidyverse)
```

#### Reading in the data

```{r}

#read in the panel survey data

raw_data <- read_csv('EU2014/All waves GENERAL.csv')

```

#### Renaming columns

```{r}
# giving columns informative names, translating dutch names, lowercasing names

df <- raw_data |>
rename(
  weight_w1 = GEWICHTA1_w1,
  weight_w2 = GEWICHTA1_w2,
  weight_w3 = GEWICHTA1_w3,
  weight_w4 = GEWICHTA1_w4,
  gender = GSL,
  age = LFT,
  education = OPLA,
  region = NIELSENCBS, 
  family_size = GEZINSGROOTTE,
  w1_date = w1_DATUM,
  w1_time = w1_TIJD,
  w2_date = w2_DATUM,
  w2_time = w2_TIJD,
  w3_date = w3_DATUM,
  w3_time = w3_TIJD,
  w4_date = w4_DATUM,
  w4_time = w4_TIJD,
) 

colnames(df) <- tolower(colnames(df))

```

#### Selecting the variables we need

+-------------------------------------------+-----------+------------+---------+---------+
|                                           | Wave 1    | Wave 2     | Wave 3  | Wave 4  |
+-------------------------------------------+-----------+------------+---------+---------+
| National identity                         | Q05       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Attitudes globalisation                   | Q32       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Vote intention EU                         | Q34       | Q35        | Q07     |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Vote intention local elections            | Q39       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Anti-immigrant attitudes                  | Q42       | Q39        |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Highest completed education               | Q61       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Income                                    | Q65       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Employment status                         | Q67       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| LFT Age                                   | age       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| GSL Gender                                | gender    |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| OPLA (Education)                          | education |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| NIELSENCBS (region)                       | region    |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **Most important issue**                  | **Q01**   | **Q01**    | **Q01** | **Q01** |
+-------------------------------------------+-----------+------------+---------+---------+
| **W1_Q54 Intergroup comfort: Muslims**    | **Q54**   | **Q48**    |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **W1_Q56 Intergroup comfort: Poles**      | **Q56**   | **Q49**    |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **W1_Q68 Ethnic minority**                | **Q68**   |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **W1_Q42 Anti-immigrant attitudes**       | **Q42**   | **Q39**    |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **W1_Q43 Immigrant follow up**            | **Q43**   | **Q40**    |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q27_1 RTL Nieuws 19.30**             |           | **Q27_1**  |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q27_2 NOS Journaal 20.00**           |           | **Q27_2**  |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q28_1 De Telegraaf**                 |           | **Q28_1**  |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q28_2 NRC Handelsblad**              |           | **Q28_2**  |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q28_6 De Volkskrant**                |           | **Q28_6**  |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| **w2_q28_11 nu.nl**                       |           | **Q28_11** |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| Political cynicism                        | Q10       | Q07        | Q11     | Q13     |
+-------------------------------------------+-----------+------------+---------+---------+
| EU-attitudes                              | Q26       | Q22        | Q27     | Q30     |
|                                           |           |            |         |         |
|                                           | Q27       | Q23        | Q29     | Q32     |
+-------------------------------------------+-----------+------------+---------+---------+
| Economic evaluation \[EU\]                | Q12       | Q09        | Q13     | Q15     |
+-------------------------------------------+-----------+------------+---------+---------+
| Self reported media exposure (TV)         | Q49       | Q44        | Q43     | Q47     |
+-------------------------------------------+-----------+------------+---------+---------+
| Self reported media exposure (newspapers) | Q50       | Q45        | Q44     | Q48     |
+-------------------------------------------+-----------+------------+---------+---------+
| Self reported media exposure (Internet)   | Q51       | Q46        | Q45     | Q49     |
+-------------------------------------------+-----------+------------+---------+---------+
| (Co) Gender                               | GSL       |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+
| (Co) Income                               | Q65     |            |         |         |
+-------------------------------------------+-----------+------------+---------+---------+

*Panel data*

Only Barbora's variables:

```{r}

df <- df |>
  select(
    intnr,
    respnr,
    sample,
    gender,
    age,
    waves,
    sample,
    education,
    region,
    family_size,
    w1_date,
    w1_time,
    w2_date,
    w2_time,
    w3_date,
    w3_time,
    w4_date,
    w4_time,
    w1_q1,
    w2_q1,
    w3_q1,
    w4_q1,
    starts_with("w1_q54"),
    starts_with("w1_q56"),
    starts_with("w1_q68"),
    starts_with("w1_q42"),
    starts_with("w1_q43"),
    starts_with("w2_q48"),
    starts_with("w2_q49"),
    starts_with("w2_q39"),
    starts_with("w2_q40"),
    w2_q27_1,
    w2_q27_2,
    w2_q28_1,
    w2_q28_2,
    w2_q28_6,
    w2_q28_11
  )

#view(df)
```


#### Parsing the numeric variables

```{r}
#view(df)
# putting the nonparsable variables first:
df <- df |> 
  relocate(w1_q68, w1_q68_yes, w1_q43,w2_q40:w2_q28_11, .after = w4_q1)

# using across to apply parse_number across parsable variables
df <- df |> 
  mutate(
    across(c(w1_q54_1:w2_q39_5), parse_number)
  )
#view(df)
```


```{r}
# using lubridate to set dates in date format

df <- df |>
  mutate(
    across(c(w1_date, w2_date, w3_date, w4_date), ymd)
  )

```

#### Lengthening the dataset

I'm asking myself whether this is wise because there's only a few questions that have multiple waves

#### Renaming variables

```{r}

df <- df |>
  rename(
    w1_most_important_issue = w1_q1,
    w2_most_important_issue = w2_q1,
    w3_most_important_issue = w3_q1,
    w4_most_important_issue = w4_q1)

df <- df |>
    rename_with(function(x) gsub("w1_q54","w1_comfort_muslims", x, fixed = TRUE)) |>
    rename_with(function(x) gsub("w1_q56", "w1_comfort_poles", x, fixed = TRUE)) |>
    rename_with(function(x) gsub("w2_q48","w2_comfort_muslims", x, fixed = TRUE)) |>
    rename_with(function(x) gsub("w2_q49", "w2_comfort_poles", x, fixed = TRUE)) |>
    rename(
      w1_ethnic_minority = w1_q68) |>
    rename(
      w1_ethnic_minority_specification = w1_q68_yes) |>
    rename_with(function(x) gsub("q39", "anti_immigrant_attitudes", x, fixed = TRUE)) |>
    rename(
      w1_immigrant_followup = w1_q43) |>
    rename(
      w2_immigrant_followup = w2_q40) |>
    rename(
      w2_media_trust_rtl = w2_q27_1,
      w2_media_trust_nos = w2_q27_2,
      w2_media_trust_telegraaf = w2_q28_1,
      w2_media_trust_nrc = w2_q28_2,
      w2_media_trust_volkskrant = w2_q28_6,
      w2_media_trust_nunl = w2_q28_11
    )

```


Pivoting the survey dataset, introducing the "wave" column

```{r}

df <- df |>  
  pivot_longer(
    cols = w1_date:last_col(),   # Selects from this column to the very last one
    names_to = c("wave", ".value"),
    names_pattern = "w(.)_(.*)"
  )

```

Changing the categorical variables into factors

```{r}
df|>
  select(!c(intnr, respnr, age, family_size, date, time, most_important_issue, ethnic_minority_specification, immigrant_followup)) |>
  is.null()

 df |>
    select(!c(intnr, respnr, age, family_size, date, time, most_important_issue, ethnic_minority_specification, immigrant_followup)) |>
    mutate(across(), .fns = as_factor())
```


```{r}
# changing categorical variables into factors

df |> 
  mutate(
    across(c(w2_media_trust_rtl:w2_anti_immigrant_attitudes_5), as_factor())
  )

```


```{# changing wave class to factor}

df <- df |>
  mutate(
    wave = as_factor(wave)
  )

# changing values of the factors

df <- df |>
  mutate(
    wave = fct_recode(
      wave,
      "1" = "1_q1",
      "2" = "2_q1",
      "3" = "3_q1",
      "4" = "4_q1"
  ))
```

```{r}

# changing values of the factors

df <- df |>
  mutate(
    wave_comfort_poles = fct_recode(
      wave_comfort_muslims,
      "1" = "w1_",
      "2" = "w2_"
  )) 

```


